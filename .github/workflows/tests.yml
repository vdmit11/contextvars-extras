name: tests

on: [push]

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: Install tox
        run: pip install tox
      - name: Run tox
        run: tox

  release:
    # needs: tests
    if: github.event_name == 'push' && github.ref == 'refs/heads/master' && !contains(github.event.head_commit.message, 'generated by python-semantic-release')
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Python Semantic Release
      uses: relekang/python-semantic-release@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        pypi_token: ${{ secrets.PYPI_TOKEN }}


    # steps:
    #   - uses: actions/checkout@v2
    #   - name: Setup Python
    #     uses: actions/setup-python@v2
    #     with:
    #       python-version: 3.7
    #   - name: Install Python packages
    #     run: pip install poetry python-semantic-release
    #   - name: Release
    #     run: |
    #       git config --global user.name "github-actions"
    #       git config --global user.email "action@github.com"
    #       semantic-release publish -D commit_author="github-actions <action@github.com>"
    #     env:
    #       GH_TOKEN: ${{secrets.GH_TOKEN}}
    #       PYPI_TOKEN: ${{secrets.PYPI_TOKEN}}
